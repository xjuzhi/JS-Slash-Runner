# è·å–ä¸–ç•Œä¹¦

<CustomTOC />

## getLorebooks

è·å–ä¸–ç•Œä¹¦åˆ—è¡¨ã€‚

```typescript
async function getLorebooks(): Promise<string[]>;
```

### è¿”å›å€¼

- **ä¸–ç•Œä¹¦åç§°åˆ—è¡¨**: `string[]`

## getLorebookEntries

è·å–ä¸–ç•Œä¹¦ä¸­çš„æ¡ç›®ä¿¡æ¯ã€‚

:::code-group

```typescript [getLorebookEntries]
async function getLorebookEntries(
  lorebook: string,
  option: GetLorebookEntriesOption = {}
): Promise<LorebookEntry[]>;
```

```typescript [GetLorebookEntriesOption]
interface GetLorebookEntriesOption {
  filter?: "none" | Partial<LorebookEntry>; // æŒ‰ç…§æŒ‡å®šå­—æ®µå€¼ç­›é€‰æ¡ç›®
}
```

```typescript [LorebookEntry]
interface LorebookEntry {
  uid: number; // uid æ˜¯ç›¸å¯¹äºä¸–ç•Œä¹¦å†…éƒ¨çš„ï¼Œä¸è¦è·¨ä¸–ç•Œä¹¦ä½¿ç”¨
  display_index: number; // é…’é¦†ä¸­å°†æ’åºè®¾ç½®ä¸º "è‡ªå®šä¹‰" æ—¶çš„æ˜¾ç¤ºé¡ºåº

  comment: string;
  enabled: boolean;
  type: "constant" | "selective" | "vectorized";
  position:
    | "before_character_definition" // è§’è‰²å®šä¹‰ä¹‹å‰
    | "after_character_definition" // è§’è‰²å®šä¹‰ä¹‹å
    | "before_example_messages" // ç¤ºä¾‹æ¶ˆæ¯ä¹‹å‰
    | "after_example_messages" // ç¤ºä¾‹æ¶ˆæ¯ä¹‹å
    | "before_author_note" // ä½œè€…æ³¨é‡Šä¹‹å‰
    | "after_author_note" // ä½œè€…æ³¨é‡Šä¹‹å
    | "at_depth_as_system" // @Dâš™
    | "at_depth_as_assistant" // @DğŸ‘¤
    | "at_depth_as_user"; // @DğŸ¤–
  depth: number | null; // ä»…å¯¹äº `position === 'at_depth_as_???'` æœ‰æ„ä¹‰ï¼›å…¶ä»–æƒ…å†µä¸º null
  order: number;
  probability: number;

  key: string[];
  logic: "and_any" | "and_all" | "not_all" | "not_any";
  filter: string[];

  scan_depth: "same_as_global" | number;
  case_sensitive: "same_as_global" | boolean;
  match_whole_words: "same_as_global" | boolean;
  use_group_scoring: "same_as_global" | boolean;
  automation_id: string | null;

  exclude_recursion: boolean;
  prevent_recursion: boolean;
  delay_until_recursion: boolean | number; // å¯ç”¨åˆ™æ˜¯ true, å¦‚æœè®¾ç½®äº†å…·ä½“çš„ Recursion Level åˆ™æ˜¯æ•°å­—

  content: string;

  group: string;
  group_prioritized: boolean;
  group_weight: number;
  sticky: number | null;
  cooldown: number | null;
  delay: number | null;
}
```

:::

### å‚æ•°

#### `lorebook`

- **ç±»å‹**: `string`
- **æè¿°**: ä¸–ç•Œä¹¦åç§°

#### `filter?`

- **ç±»å‹**: `"none" | Partial<LorebookEntry>`
- **æè¿°**: æŒ‰ç…§æŒ‡å®šå­—æ®µå€¼ç­›é€‰æ¡ç›®ï¼Œè¦æ±‚å¯¹åº”å­—æ®µå€¼åŒ…å«åˆ¶å®šçš„å†…å®¹ï¼›é»˜è®¤ä¸ºä¸è¿›è¡Œç­›é€‰.å¦‚ `{content: 'ç¥ä¹å…‰'}` è¡¨ç¤ºå†…å®¹ä¸­å¿…é¡»æœ‰ `'ç¥ä¹å…‰'`, `{type: 'selective'}` è¡¨ç¤ºä»…è·å–ç»¿ç¯æ¡ç›®.
  - `"none"`: ä¸ç­›é€‰
  - `Partial<LorebookEntry>`: æŒ‰ç…§æŒ‡å®šå­—æ®µå€¼ç­›é€‰æ¡ç›®ï¼Œè¯¦è§ [`LorebookEntry`](./è·å–ä¸–ç•Œä¹¦#getlorebookentries)

:::warning
ç”±äºå®ç°é™åˆ¶ï¼Œåªèƒ½åšåˆ°ç®€å•ç­›é€‰ï¼›å¦‚æœéœ€è¦æ›´å¤æ‚çš„ç­›é€‰ï¼Œè¯·è·å–æ‰€æœ‰æ¡ç›®ç„¶åè‡ªå·±ç­›é€‰ã€‚
:::

### ç¤ºä¾‹

:::code-group

```typescript [è·å–æ‰€æœ‰æ¡ç›®]
// è·å–ä¸–ç•Œä¹¦ä¸­æ‰€æœ‰æ¡ç›®çš„æ‰€æœ‰ä¿¡æ¯
const entries = await getLorebookEntries("eramgtå°‘å¥³æ­Œå‰§");
```

```typescript [æŒ‰å†…å®¹ç­›é€‰]
// æŒ‰å†…å®¹ç­›é€‰ï¼Œcontent ä¸­å¿…é¡»å‡ºç° `'ç¥ä¹å…‰'`
const entries = await getLorebookEntries("eramgtå°‘å¥³æ­Œå‰§", {
  filter: { content: "ç¥ä¹å…‰" },
});
```

:::

## getLorebookSettings

è·å–å½“å‰çš„ä¸–ç•Œä¹¦å…¨å±€è®¾ç½®ã€‚

:::code-group

```typescript [getLorebookSettings]
async function getLorebookSettings(): Promise<LorebookSettings>;
```

```typescript [LorebookSettings]
interface LorebookSettings {
  selected_global_lorebooks: string[];

  scan_depth: number;
  context_percentage: number;
  budget_cap: number; // 0 è¡¨ç¤ºç¦ç”¨
  min_activations: number;
  max_depth: number; // 0 è¡¨ç¤ºæ— é™åˆ¶
  max_recursion_steps: number;

  include_names: boolean;
  recursive: boolean;
  case_sensitive: boolean;
  match_whole_words: boolean;
  use_group_scoring: boolean;
  overflow_alert: boolean;

  insertion_strategy: "evenly" | "character_first" | "global_first";
}
```

:::

### è¿”å›å€¼

- **selected_global_lorebooks**: `string[]`
- **scan_depth**: `number`
- **context_percentage**: `number`
- **budget_cap**: `number`
- **min_activations**: `number`
- **max_depth**: `number`
- **max_recursion_steps**: `number`
- **include_names**: `boolean`
- **recursive**: `boolean`
- **case_sensitive**: `boolean`
- **match_whole_words**: `boolean`
- **use_group_scoring**: `boolean`
- **overflow_alert**: `boolean`
- **insertion_strategy**: `"evenly" | "character_first" | "global_first"`

### ç¤ºä¾‹

```typescript
// è·å–å…¨å±€å¯ç”¨çš„ä¸–ç•Œä¹¦
const settings = await getLorebookSettings();
alert(settings.selected_global_lorebooks);
```

## getCharLorebooks

è·å–è§’è‰²å¡ç»‘å®šçš„ä¸–ç•Œä¹¦ã€‚

:::code-group

```typescript [getCharLorebooks]
async function getCharLorebooks(
  option: GetCharLorebooksOption = {}
): Promise<CharLorebook[]>;
```

```typescript [CharLorebook]
interface CharLorebook {
  name: string;
  type: "primary" | "additional";
}
```

```typescript [GetCharLorebooksOption]
interface GetCharLorebooksOption {
  name?: string; // è¦æŸ¥è¯¢çš„è§’è‰²å¡åç§°ï¼›é»˜è®¤ä¸ºå½“å‰è§’è‰²å¡
  type?: "all" | "primary" | "additional"; // æŒ‰è§’è‰²ä¸–ç•Œä¹¦çš„ç»‘å®šç±»å‹ç­›é€‰ä¸–ç•Œä¹¦ï¼›é»˜è®¤ä¸º 'all'
}
```

:::

### å‚æ•°

#### `name?`

- **ç±»å‹**: `string`
- **æè¿°**: è¦æŸ¥è¯¢çš„è§’è‰²å¡åç§°ï¼›é»˜è®¤ä¸ºå½“å‰è§’è‰²å¡

#### `type?`

- **ç±»å‹**: `"all" | "primary" | "additional"`
- **æè¿°**: æŒ‰è§’è‰²ä¸–ç•Œä¹¦çš„ç»‘å®šç±»å‹ç­›é€‰ä¸–ç•Œä¹¦ï¼›é»˜è®¤ä¸º `"all"`

### è¿”å›å€¼

- **CharLorebook æ•°ç»„**: [`CharLorebook[]`](./è·å–ä¸–ç•Œä¹¦#getCharLorebooks)

### ç¤ºä¾‹

:::code-group
```typescript [è·å–å½“å‰è§’è‰²å¡ç»‘å®šçš„æ‰€æœ‰ä¸–ç•Œä¹¦]
const lorebooks = await getCharLorebooks();
```
```typescript [è·å–å½“å‰è§’è‰²å¡ç»‘å®šçš„ä¸»è¦ä¸–ç•Œä¹¦]
const primaryLorebook = await getCharLorebooks({ type: "primary" });
```
:::

## getCurrentCharPrimaryLorebook

è·å–å½“å‰è§’è‰²å¡ç»‘å®šçš„ä¸»è¦ä¸–ç•Œä¹¦ã€‚

```typescript
async function getCurrentCharPrimaryLorebook(): Promise<string | null>;
```

### è¿”å›å€¼

- **ä¸»è¦ä¸–ç•Œä¹¦åç§°**: `string | null` - å¦‚æœå½“å‰è§’è‰²å¡æœ‰ç»‘å®šå¹¶ä½¿ç”¨ä¸–ç•Œä¹¦ (åœ°çƒå›¾æ ‡å‘ˆç»¿è‰²), è¿”å›è¯¥ä¸–ç•Œä¹¦çš„åç§°ï¼›å¦åˆ™è¿”å› `null`

## getOrCreateChatLorebook

è·å–æˆ–åˆ›å»ºå½“å‰èŠå¤©ç»‘å®šçš„ä¸–ç•Œä¹¦ã€‚

```typescript
async function getOrCreateChatLorebook(): Promise<string>;
```

### è¿”å›å€¼

- **èŠå¤©ä¸–ç•Œä¹¦åç§°**: `string`

